[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2022-10-22 13:20:14.778840",
  "module": "Core ERP",
  "name": "item",
  "script": "frappe.ui.form.on('Item', {\n\tonload(frm) {\n\t\tcur_frm.set_query(\"item_subgroup\", function() {\n\t\t\treturn {\n\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Subgroup Master\", \"parent_group\", \"=\", cur_frm.doc.item_group]\n\t\t\t\t]\n\t\t\t};\n\t\t});\n\t\n    // cur_frm.set_query(\"item_category\", function() {\n    // \t\t\treturn {\n    //                 filters: [\n    // \t\t\t\t \t[\"Category\", \"parent_group\", \"in\", cur_frm.doc.item_group]\n    // \t\t\t\t]\n    // \t\t\t};\n    // \t\t});\n    \t},\n// \tvalidate(frm){\n// \t    frm.set_value(\"item_code\", (frm.doc.abbr+frm.doc.cat_abbr+frm.doc.subgroup_abbr))\n// \t}\n    \n});\n\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2022-10-20 15:19:03.199904",
  "module": "Core ERP",
  "name": "Purchase Order",
  "script": "frappe.ui.form.on('Purchase Order', {\n\tcost_center(frm){\n\t\tif (frm.doc.po_type==\"General\" && frm.doc.cost_center==\"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/GEN/J1/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"General\" && frm.doc.cost_center==\"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/GEN/J2/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Raw Material - Domestic\" && frm.doc.cost_center==\"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/RM/J1/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Raw Material - Domestic\" && frm.doc.cost_center==\"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/RM/J2/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Import\" && frm.doc.cost_center==\"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/IM/J2/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Import\" && frm.doc.cost_center==\"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/IM/J1/.FY./\");\n\t\t}\n\t\tif (frm.doc.cost_center == \"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"billing_address\", \"JBL-Surajpur G.Noida-Billing\")\n\t\t    frm.set_value(\"shipping_address\", \"JBL-Surajpur G.Noida-Billing\")\n\t\t}\n\t\tif (frm.doc.cost_center == \"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"billing_address\",  \"JBL-Noida-Billing\")\n\t\t    frm.set_value(\"shipping_address\",  \"JBL-Noida-Billing\")\n\t\t}\n\t\t\n\t},\n\tpo_type(frm){\n\t\tif (frm.doc.po_type==\"General\" && frm.doc.cost_center==\"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/GEN/J1/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"General\" && frm.doc.cost_center==\"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/GEN/J2/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Raw Material - Domestic\" && frm.doc.cost_center==\"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/RM/J1/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Raw Material - Domestic\" && frm.doc.cost_center==\"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/RM/J2/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Import\" && frm.doc.cost_center==\"Surajpur J2 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/IM/J2/.FY./\");\n\t\t}\n\t\tif (frm.doc.po_type==\"Import\" && frm.doc.cost_center==\"Noida J1 - JBL\"){\n\t\t    frm.set_value(\"naming_series\",\"PO/IM/J1/.FY./\");\n\t\t}\n\tif (frm.doc.po_type == \"Import\"){\n \t\t    frm.set_value(\"currency\", \"USD\")\n    }\n\t},\n\trefresh(frm){\n\t    if (frm.doc.po_type==\"Raw Material - Domestic\"){\n\t        frm.set_value(\"cost_center\",\"Noida J1 - JBL\")\n\t    }\n\t   // if (frm.doc.po_type == \"General\" && frm.doc.po_subtype == \"Routine\" && frm.doc.grand_total < 10000){\n\t   //     frappe.db.set_value(\"Purcha\"\"workflow_state\", \"Approved\")\n\t   // }\n\t},\n\t\n\t\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2022-10-11 14:37:24.362087",
  "module": "Core ERP",
  "name": "Opportunity",
  "script": "frappe.ui.form.on('Opportunity', {\n        onload(frm) {\n            frm.set_query('item_code', 'items', () => {\n                return {\n                    filters: {\n                        item_group: 'Finished Goods'\n                    }\n                }\n            })\n            frappe.call({\n                method: \"frappe.client.get_list\",\n                args: {\n                    doctype: \"Building Factor Reference Table\",\n                    fields: ['job_weight_kgs', 'job_weight_kg', 'building_factor', 'type_of_order']\n                },\n\n                callback: function(r) {\n                    if (r.message) {\n                        $.each(r.message, function(i, row) { // row can be anything, it is merely a name\n                            var child_add = frm.add_child(\"building_factor_items\"); // child_add can be anything\n                            child_add.job_weight_kgs = row.job_weight_kgs;\n                            child_add.job_weight_kg = row.job_weight_kg;\n                            child_add.building_factor = row.building_factor;\n                            child_add.type_of_order = row.type_of_order;\n                        });\n                        frm.refresh_fields(\"building_factor_items\");\n                    }\n                }\n\n            })\n        }\n    }),\n    frappe.ui.form.on('Opportunity Item', {\n        quantity(frm, cdt, cdn) {\n            var d = locals[cdt][cdn];\n            if (d.quantity) {\n                frappe.model.set_value(cdt, cdn, \"qty\", d.weight_per_job * d.quantity)\n            }\n        },\n        no_load_losses(frm, cdt, cdn) {\n            var d = locals[cdt][cdn];\n            $.each(frm.doc.building_factor_items, function(i, e) {\n                if (d.weight_per_job > e.job_weight_kgs && d.no_load_losses < e.job_weight_kg) {\n                    console.log(e.building_factor)\n                    // frm.set_value(\"builing_factor\", \"e.building_factor\")\n                    let bf = e.building_factor;\n                    console.log(bf)\n                    let b = (d.no_load_losses / d.weight_per_job / (1 + bf)).toFixed(3)\n                    frappe.model.set_value(cdt, cdn, \"guaranteed_core_losses\", b)\n                }\n            })\n        }\n\n    })",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2022-09-15 13:03:30.999821",
  "module": "Core ERP",
  "name": "Quotation",
  "script": "frappe.ui.form.on('Quotation', {\n\trefresh(frm) {\n\t\tfrm.set_value(\"offer_validity\",frappe.datetime.add_days(frm.doc.transaction_date, 7))\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2022-09-15 18:13:39.034452",
  "module": "Core ERP",
  "name": "Sales Order",
  "script": "frappe.ui.form.on('Sales Order', {\n\ttolerance_allowed(frm) {\n        if (frm.doc.tolerance_allowed != 0.5 && frm.doc.tolerance_allowed != 1.0 && frm.doc.tolerance_allowed != 1.5\n        && frm.doc.tolerance_allowed != 2.0 && frm.doc.tolerance_allowed != 2.5){\n            frappe.throw(\"Please enter a valid Tolerance Allowed\")\n            //frm.set_value(\"tolerance_allowed\", null)\n        }\n}\n\t});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 1,
  "modified": "2022-10-12 16:34:24.598537",
  "module": "Core ERP",
  "name": "Purchase Invoice",
  "script": "frappe.ui.form.on('Purchase Invoice', {\n\t refresh(frm){\n\t   if(frm.doc.__islocal){\n\t\tfrm.set_value(\"total_rm_cost_value\", parseInt(frm.doc.total) + parseInt(frm.doc._custom_duty) + parseInt(frm.doc.loading_unloading_charges)\n\t\t+ parseInt(frm.doc.stamp_duty) + parseInt(frm.doc.sims_charges) + parseInt(frm.doc.inland_haulage_freight_cost) + parseInt(frm.doc.commission)\n\t\t+ parseInt(frm.doc.custom_clearance_charges) + parseInt(frm.doc.local_freight_cost) + parseInt(frm.doc.detention_demurrage_yard_cahrges))\n\t\tfrm.set_value(\"landed_price_inr_kg\", parseInt(frm.doc.total_rm_cost_value)/parseInt(frm.doc.total_qty))\n\t}},\n\tcost_center(frm){\n    \tif (frm.doc.cost_center == \"Surajpur J2 - JBL\"){\n    \t    frm.set_value(\"billing_address\", \"JBL-Surajpur G.Noida-Billing\")\n    \t    frm.set_value(\"shipping_address\", \"JBL-Surajpur G.Noida-Billing\")\n    \t}\n    \tif (frm.doc.cost_center == \"Noida J1 - JBL\"){\n    \t    frm.set_value(\"billing_address\",  \"JBL-Noida-Billing\")\n    \t    frm.set_value(\"shipping_address\",  \"JBL-Noida-Billing\")\n    \t}\n\t}\n\t\t\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "modified": "2022-10-18 12:49:46.303818",
  "module": "Core ERP",
  "name": "Purchase Receipt",
  "script": "frappe.ui.form.on('Purchase Receipt', {\n\tafter_save(frm) {\n\t     var name = frm.doc.name;\n\t     var a = name.split(\"-\")\n\t    frm.set_value(\"abbr\", a[3])\n}\n})\n\n\n// frappe.ui.form.on('Purchase Receipt Item', {\n// \tafter_save(frm, cdt, cdn){\n// \t   var d = locals[cdt][cdn];\n// \t   var name = frm.doc.name;\n// \t     var a = name.split(\"-\")\n// \t     b = a[3];\n// \t     console.log(a[3])\n// \t     console.log(b)\n// \t    for(var i=0; i==frm.doc.items.length; i++){\n// \t       frappe.model.set_value(cdt, cdn, \"batch_no\", b)\n// \t   }\n// \t   frappe.model.set_value(cdt, cdn, \"batch_no\", b)\n\t    \n// \t}\n\t\n// })",
  "view": "Form"
 }
]